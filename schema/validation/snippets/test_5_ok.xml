<?xml version="1.0" encoding="UTF-8"?>
<!-- 
    The INSTANCE element defines a complex ObjectType or DataType.
    It may be a child of several other elements, and the requirements on
    the content (especially ID and dmrole), may differ depending on 
    the usage:

    1) Child of GLOBALS:
       In this case the INSTANCE is a single stand-alone instance which
       may or may not be referenced by other INSTANCEs.
       - may have ID, as target of REFERENCE.ref
       - must have no or empty dmrole

    2) Child of TEMPLATES:
       In this case, the INSTANCE is a template for instances which
       are generated once per row of the associated table.
       - may have ID, as target of JOIN.dmref
       - must have no or empty dmrole

    3) Child of COLLECTION (as option in ORM selection):
       Each member INSTANCE is an option for selection using PRIMARY/FOREIGN_KEY.
       * only viable in GLOBALS environment
       Each member INSTANCE:
       - must contain at least one PRIMARY_KEY sub-element
       - may have ID, as target of REFERENCE.ref
       - must have no or empty dmrole

    4) Child of COLLECTION (as array/list element):
       Each member INSTANCE is a cell of an element with multiplicity > 1
       - may have ID, as target of REFERENCE.ref
       - must have no or empty dmrole
         * dmrole is inherited from the parent COLLECTION

    5) Child of INSTANCE:
       In this case, each INSTANCE represents a complex ObjectType or
       DataType playing a role in the parent INSTANCE.
       - may have ID, as target of REFERENCE.ref
       - must have non-empty dmrole

    *) any INSTANCE:
       - if ID is present, it must not be empty
       - must have non-empty dmtype
-->
<dm-mapping:VODML
	xmlns:dm-mapping="http://www.ivoa.net/xml/merged-syntax">

	<dm-mapping:MODEL name="model" url="http://aaaaaa" />
	<dm-mapping:GLOBALS >

		<dm-mapping:COLLECTION ID="_coordsys" dmrole="" >
		<!-- Usage 3: Child of COLLECTION, for ORM selection -->

			<!-- Test Case 5.22: ID + empty dmrole + dmtype; ID optional, must have no or empty dmrole. -->
			<!-- Test Case 5.51: with PRIMARY_KEY; must be first  -->
			<dm-mapping:INSTANCE ID="_timesys" dmrole="" dmtype="model:TimeSys" >
				<dm-mapping:PRIMARY_KEY dmtype="ivoa:string" value="TCB"/>
			</dm-mapping:INSTANCE>
			
			<!-- Test Case 5.23: no ID + empty dmrole + dmtype; ID optional, must have no or empty dmrole. -->
			<dm-mapping:INSTANCE dmrole="" dmtype="model:SpaceSys" >
				<dm-mapping:PRIMARY_KEY dmtype="ivoa:string" value="ICRS"/>
			</dm-mapping:INSTANCE>
			
			<!-- Test Case 5.24: ID + no dmrole + dmtype; ID optional, must have no or empty dmrole. -->
			<dm-mapping:INSTANCE ID="_photsys_BP" dmtype="model:PhotometrySys" >
				<dm-mapping:PRIMARY_KEY dmtype="ivoa:string" value="BP"/>
			</dm-mapping:INSTANCE>
			
			<!-- Test Case 5.25: no ID + no dmrole + dmtype; ID optional, must have no or empty dmrole. -->
			<dm-mapping:INSTANCE dmtype="model:PhotometrySys" >
				<dm-mapping:PRIMARY_KEY dmtype="ivoa:string" value="RP"/>
			</dm-mapping:INSTANCE>
			
		</dm-mapping:COLLECTION>
		<dm-mapping:COLLECTION ID="_Datasets" >
		<!-- Usage 3: Child of COLLECTION, for ORM selection -->

			<!-- Test Case 5.52: with multiplie PRIMARY_KEY; allow zero or more. -->
			<dm-mapping:INSTANCE ID="_ds1" dmtype="ds:experiment.ObsDataset">
				<dm-mapping:PRIMARY_KEY dmtype="ivoa:string" value="5813181197970338560"/>
				<dm-mapping:PRIMARY_KEY dmtype="ivoa:string" value="VEGA"/>
			</dm-mapping:INSTANCE>
			<dm-mapping:INSTANCE ID="_ds2" dmtype="ds:experiment.ObsDataset">
				<dm-mapping:PRIMARY_KEY dmtype="ivoa:string" value="5813181545327453273"/>
				<dm-mapping:PRIMARY_KEY dmtype="ivoa:string" value="SIRIUS"/>
			</dm-mapping:INSTANCE>
			
		</dm-mapping:COLLECTION>

	<!-- Usage 1: Child of GLOBALS -->
		<!-- Test Case 5.3: ID + empty dmrole + dmtype; ID optional, must have no or empty dmrole. -->
		<dm-mapping:INSTANCE ID="_xyz" dmrole="" dmtype="model:thing" >
		<!-- Usage 5: Child of INSTANCE -->

			<!-- Test Case 5.40: ID + dmrole + dmtype; ID optional, must have dmrole. -->
			<dm-mapping:INSTANCE ID="_xxx" dmrole="model.thing.a" dmtype="model:foo" />

			<!-- Test Case 5.41: no ID + dmrole + dmtype; ID optional, must have dmrole. -->
			<dm-mapping:INSTANCE dmrole="model.thing.b" dmtype="model:bar" />

			<dm-mapping:COLLECTION dmrole="model.thing.c">
			<!-- Usage 4: Child of COLLECTION, as array/list element -->

				<!-- Test Case 5.32: ID + empty dmrole + dmtype; ID optional, must have no or empty dmrole. -->
				<dm-mapping:INSTANCE ID="_uiebb" dmrole="" dmtype="model:alpha" />

				<!-- Test Case 5.33: no ID + empty dmrole + dmtype; ID optional; must have no or empty dmrole). -->
				<dm-mapping:INSTANCE dmrole="" dmtype="model:alpha" />

				<!-- Test Case 5.34: ID + no dmrole + dmtype; ID optional; must have no or empty dmrole -->
				<dm-mapping:INSTANCE ID="_uiebd" dmtype="model:alpha" />

				<!-- Test Case 5.35: no ID + no dmrole + dmtype; ID optional; must have no or empty dmrole. -->
				<dm-mapping:INSTANCE dmtype="model:alpha" />
				
			</dm-mapping:COLLECTION>

		</dm-mapping:INSTANCE>
		
		<!-- Test Case 5.4: no ID + empty dmrole + dmtype; ID optional, must have no or empty dmrole. -->
		<dm-mapping:INSTANCE dmrole="" dmtype="model:thing" />

		<!-- Test Case 5.5: ID + no dmrole + dmtype; ID optional, must have no or empty dmrole. -->
		<dm-mapping:INSTANCE ID="_xyz" dmtype="model:thing" />

		<!-- Test Case 5.6: no ID + no dmrole + dmtype; ID optional, must have no or empty dmrole. -->
		<dm-mapping:INSTANCE dmtype="model:thing" />

	</dm-mapping:GLOBALS>
	<dm-mapping:TEMPLATES tableref="fgdgfddf">
	<!-- Usage 2: Child of TEMPLATES -->

		<!-- Test Case 5.50: All subelements optional  -->

		<!-- Test Case 5.12: ID + empty dmrole + dmtype; ID optional, must have no or empty dmrole. -->
		<dm-mapping:INSTANCE ID="aaaa" dmrole="" dmtype="fffff" />

		<!-- Test Case 5.13: no ID + empty dmrole + dmtype; ID optional, must have no or empty dmrole -->
		<dm-mapping:INSTANCE dmrole="" dmtype="fffff" />
		

		<!-- Test Case 5.14: ID + no dmrole + dmtype; ID optional, must have no or empty dmrole. -->
		<dm-mapping:INSTANCE ID="aaaa" dmtype="fffff" />

		<!-- Test Case 5.15: no ID + no dmrole + dmtype; ID optional, must have no or empty dmrole -->
		<dm-mapping:INSTANCE dmtype="fffff" />
		

		<!-- Test Case 5.53: with ATTRIBUTE; zero or more A|I|R|C, any order -->
		<dm-mapping:INSTANCE ID="aaaa" dmtype="model:thing">
			<dm-mapping:ATTRIBUTE dmrole="model.thing.a" dmtype="model:foo" value="eeee"/>
		</dm-mapping:INSTANCE>
		
		<!-- Test Case 5.54: with INSTANCE; zero or more A|I|R|C, any order -->
		<dm-mapping:INSTANCE ID="aaaa" dmtype="model:thing">
			<dm-mapping:INSTANCE dmrole="model:thing.b" dmtype="model:bar" />
		</dm-mapping:INSTANCE>
        
		<!-- Test Case 5.55: with REFERENCE; zero or more A|I|R|C, any order -->
		<dm-mapping:INSTANCE ID="aaaa" dmtype="model:thing">
			<dm-mapping:REFERENCE dmrole="model.thing.c" dmref="_fffff"/>
		</dm-mapping:INSTANCE>
        
		<!-- Test Case 5.56: with COLLECTION; zero or more A|I|R|C, any order -->
		<dm-mapping:INSTANCE ID="aaaa" dmtype="model:thing">
			<dm-mapping:COLLECTION dmrole="model:thing.d" />
		</dm-mapping:INSTANCE>

		<!-- Test Case 5.58: multiple (A,I,R,C) random order -->
		<dm-mapping:INSTANCE ID="_ref1" dmtype="model:thing">
			<dm-mapping:INSTANCE   dmrole="model.thing.b" dmtype="model:bar" />
			<dm-mapping:COLLECTION dmrole="model.thing.d"/>
			<dm-mapping:ATTRIBUTE  dmrole="model.thing.a" dmtype="model.foo" value="eeee"/>
			<dm-mapping:REFERENCE  dmrole="model.thing.c" dmref="_fffff"/>
			<dm-mapping:COLLECTION dmrole="model.thing.e"/>
			<dm-mapping:INSTANCE   dmrole="model.thing.f" dmtype="model:alpha" />
			<dm-mapping:REFERENCE  dmrole="model.thing.g" dmref="_ggggg"/>
			<dm-mapping:ATTRIBUTE  dmrole="model.thing.h" dmtype="model:beta" value="eeee"/>
		</dm-mapping:INSTANCE>

		<dm-mapping:INSTANCE ID="_ref2" dmrole="" dmtype="model:thing">
			<dm-mapping:COLLECTION dmrole="model:thing.items">
			<!-- Usage 4: Child of COLLECTION, as array/list element -->
			
				<!-- Test Case 5.xx: Usage within TEMPLATES environment -->
				<dm-mapping:INSTANCE dmrole="" dmtype="fffff">
					<dm-mapping:PRIMARY_KEY dmtype="fffff" value="tttt" />
				</dm-mapping:INSTANCE>
				
			</dm-mapping:COLLECTION>
		</dm-mapping:INSTANCE>

	</dm-mapping:TEMPLATES>
</dm-mapping:VODML>
