<?xml version="1.0" encoding="UTF-8"?>

<!-- NOTE: GLOBALS node allows multiple COLLECTION sub-nodes.                     -->
<!--       We take advantage of this to test several valid cases in the same file -->

<!--
    The COLLECTION element is used for multple purposes, each having a limited 
    subset of elements for its content. 
     1) Array attribute (multiplicity > 1).
        COLLECTION contains the array as a set of ATTRIBUTE nodes
        The dmrole of the COLLECTION is inherited by its contents.
     2) Reference relation with multiplicity > 1
        COLLECTION contains the set of REFERENCEs
        The dmrole of the COLLECTION is inherited by its contents.
     3) Composition relation with multiplicity > 1
        COLLECTION contains the set of INSTANCEs, either direct INSTANCE or through JOIN
     4) Proxy for TABLE; grouping of common INSTANCES for selection by PRIMARY/FOREIGN key.
        COLLECTION contains the set of INSTANCES to be selected from.
        COLLECTION MUST have an ID, used as the tableref in the corresponding REFERENCEs
        COLLECTION has no specified dmrole (is empty)
-->

<dm-mapping:VODML
	xmlns:dm-mapping="http://www.ivoa.net/xml/merged-syntax">

	<dm-mapping:MODEL name="model" url="http://aaaaaa" />
	<dm-mapping:GLOBALS>
	        <!-- Test Note 8: All subnodes are optional, with 2 sets which may be combined under 1 COLLECTION. -->
	  
	        <!-- Test Case 8.1: empty COLLECTION -->
		<dm-mapping:COLLECTION ID="_ds1" dmrole="abc" />

		<!-- Test Case 8.2: ID optional, dmrole must not be blank -->
		<dm-mapping:COLLECTION dmrole="role" />

		<!-- Test Case 8.5: with ID, dmrole may be blank -->
		<dm-mapping:COLLECTION ID="_ds2" dmrole="" />

		<!-- Test Case 8.6: COLLECTION of ATTRIBUTE -->
		<dm-mapping:COLLECTION dmrole="A.b">
			<dm-mapping:ATTRIBUTE dmrole="A.b" dmtype="model:elem" value="foo" />
		</dm-mapping:COLLECTION>
		
		<!-- Test Case 8.7: COLLECTION of REFERENCE -->
		<dm-mapping:COLLECTION dmrole="abc">
			<dm-mapping:REFERENCE dmrole="A" dmref="_ref1" />
		</dm-mapping:COLLECTION>

		<!-- Test Case 8.8: COLLECTION of INSTANCE -->
		<dm-mapping:COLLECTION ID="_ds3" dmrole="abc">
			<dm-mapping:INSTANCE dmrole="A" dmtype="ds:experiment.ObsDataset" />
		</dm-mapping:COLLECTION>

		<!-- Test Case 8.9: COLLECTION of JOIN -->
		<dm-mapping:COLLECTION dmrole="abc">
			<dm-mapping:JOIN tableref="Results" />
		</dm-mapping:COLLECTION>

		<!-- Test Case 8.10: COLLECTION of COLLECTION -->
		<!--   Q: what is COLLECTION of COLLECTION for again? -->
		<dm-mapping:COLLECTION dmrole="acb">
			<dm-mapping:COLLECTION dmrole="def"/>
		</dm-mapping:COLLECTION>

		<!-- Test Case 8.11: COLLECTION of multiple (ATTRIBUTE|REFERENCE) subnodes, random order -->
		<!--   Q: what should 'dmrole' of subnodes be (empty or same or random)? -->
		<!--   A: content should not have a specified dmrole (is on container), however
		          most of the allowed contents do not generally allow empty/missing dmrole -->
		<!--   Q: should these be allowed in combination?                        -->
		<dm-mapping:COLLECTION dmrole="role">
			<dm-mapping:REFERENCE dmrole="A" dmref="_ref1" />
			<dm-mapping:REFERENCE dmrole="A" dmref="_ref2" />
		</dm-mapping:COLLECTION>

		<!-- Test Case 8.12: COLLECTION of multiple (INSTANCE|JOIN|COLLECTION) subnodes, random order -->
		<dm-mapping:COLLECTION dmrole="role">
			<dm-mapping:INSTANCE dmrole="A" dmtype="ds:experiment.ObsDataset" />
			<dm-mapping:COLLECTION dmrole="B">
				<dm-mapping:INSTANCE dmrole="B.a" dmtype="ds:experiment.ObsDataset" />
			</dm-mapping:COLLECTION>
			<dm-mapping:COLLECTION dmrole="C">
				<dm-mapping:JOIN tableref="Results" />
			</dm-mapping:COLLECTION>
			<dm-mapping:INSTANCE dmrole="D" dmtype="ds:experiment.ObsDataset" />
			<dm-mapping:JOIN tableref="MoreResults" />
			<!-- allow multiple JOIN nodes.. to build a COLLECTION of instances from different tables -->
			<dm-mapping:JOIN tableref="EvenMoreResults" />
		</dm-mapping:COLLECTION>  
		      
		<!-- Test Case 8.13: mixed subnode sets -->
	    <!--   * allow (A,R) or (I,J,C) only    -->
		<dm-mapping:COLLECTION dmrole="role">
			<dm-mapping:ATTRIBUTE dmrole="A.b" dmtype="model:elem" value="foo" />
		</dm-mapping:COLLECTION>
			
		
	</dm-mapping:GLOBALS>
	
</dm-mapping:VODML>
